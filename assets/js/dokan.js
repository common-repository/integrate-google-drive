(()=>{var e,n,i;e=jQuery,n=window.ModuleBuilderModal,i={init:function(){e(".insert-file-row").after('<div class="igd-dokan"><button type="button" class="dokan-btn dokan-btn-default igd-wc-button"><img src="'.concat(igd.pluginUrl,'/assets/images/drive.png" width="20"/><span>').concat(wp.i18n.__("Add File","integrate-google-drive"),"</span></button></div>")),e(document).on("click",".dokan-btn.igd-wc-button",i.handleDokanFileSelector),e(document).on("click",".save-upload-settings",i.saveDokanUploadSettings),e(document).on("click",".dokan-igd-settings .remove-account",i.handleDokanAccountRemove),e(document).on("click","#igd-dokan-select-media-folders",i.selectMediaLibraryFolders),e(document).on("click",".save-media-library-settings",i.saveMediaLibrarySettings)},saveMediaLibrarySettings:function(){var n=this;wp.ajax.send("igd_save_dokan_media_library_settings",{data:{data:e("#igd-dokan-media-library-settings").serialize(),nonce:igd.nonce},beforeSend:function(){e(n).find("i").removeClass("fa-save").addClass("fa-spinner fa-spin")},success:function(n){e(".dokan-igd-media-library-ajax-response").show()},error:function(e){console.log(e)},complete:function(){e(n).find("i").removeClass("fa-spin fa-spinner").addClass("fa-save")}})},selectMediaLibraryFolders:function(){Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap"></div>',showConfirmButton:!1,customClass:{container:"igd-swal igd-module-builder-modal-container"},didOpen:function(o){var a,t=document.getElementById("igd-select-files"),d=null===(a=e("#igd_dokan_media_folders").val())||void 0===a?void 0:a.trim(),s=d&&""!==d&&'""'!==d?JSON.parse(d):[];ReactDOM.render(React.createElement(n,{initData:{folders:s},onUpdate:function(n){var o=n.folders,a=(void 0===o?[]:o).map((function(e){return{id:e.id,accountId:e.accountId,name:e.name,iconLink:e.iconLink}}));e("#igd_dokan_media_folders").val(JSON.stringify(a)),i(a),Swal.close()},onClose:function(){return Swal.close()},isSelectFiles:!0,selectionType:"folders"}),t)},willClose:function(e){var n=document.getElementById("igd-select-files");ReactDOM.unmountComponentAtNode(n)}});var i=function(n){var i=e(".media-folders");i.empty(),n.map((function(e){var n=e.id,o=e.name;i.append('\n                    <div class="folder-item" data-id="'.concat(n,'">\n                        <img src="https://drive-thirdparty.googleusercontent.com/16/type/application/vnd.google-apps.folder">\n                        ').concat(o,'\n\x3c!--                        <i class="dashicons dashicons-no-alt"></i>--\x3e\n                    </div>\n                    '))}))}},handleDokanAccountRemove:function(){var n=this;Swal.fire({title:wp.i18n.__("Are you sure?","integrate-google-drive"),text:wp.i18n.__("You won't be able to revert this!","integrate-google-drive"),icon:"warning",showCancelButton:!0,confirmButtonText:wp.i18n.__("Yes, remove it!","integrate-google-drive"),reverseButtons:!0,showLoaderOnConfirm:!0,customClass:{container:"igd-swal"},preConfirm:function(){var i=e(n).closest(".igd-account-item").data("id");return wp.ajax.post("igd_delete_account",{id:i,nonce:igd.nonce})}}).then((function(i){i.value&&(e(n).closest(".igd-account-item").remove(),Swal.fire({title:wp.i18n.__("Removed!","integrate-google-drive"),text:wp.i18n.__("Account has been removed.","integrate-google-drive"),icon:"success",showConfirmButton:!1,timer:1500,toast:!0}))}))},handleDokanFileSelector:function(i){var o=e(this).parents(".dokan-download-wrapper");Swal.fire({html:'<div id="igd-select-files" class="igd-module-builder-modal-wrap"></div>',showConfirmButton:!1,customClass:{container:"igd-swal igd-module-builder-modal-container"},didOpen:function(i){ReactDOM.render(React.createElement(n,{initData:{},onUpdate:function(n){var i=n.folders,a=void 0===i?[]:i,t=o.find("tbody"),d=o.find(".insert-file-row ").data("row");a.map((function(n){var i=n.id,o=n.name,a=n.type,s=n.accountId,c="https://drive.google.com/open?action=igd-wc-download&id=".concat(i,"&account_id=").concat(s,"&name=").concat(o,"&type=").concat(a),l=e(d);l.find('[name="_wc_file_names[]"]').val(o),l.find('[name="_wc_file_urls[]"]').val(c),t.append(l)})),Swal.close()},onClose:function(){return Swal.close()},isSelectFiles:"dokan"}),document.getElementById("igd-select-files"))},willClose:function(e){ReactDOM.unmountComponentAtNode(document.getElementById("igd-select-files"))}})},saveDokanUploadSettings:function(){var n=this;wp.ajax.send("igd_save_dokan_upload_settings",{data:{data:e("#igd-dokan-upload-settings").serialize(),nonce:igd.nonce},beforeSend:function(){e(n).find("i").removeClass("fa-save").addClass("fa-spinner fa-spin")},success:function(n){e(".dokan-igd-upload-ajax-response").show()},error:function(e){console.log(e)},complete:function(){e(n).find("i").removeClass("fa-spin fa-spinner").addClass("fa-save")}})}},e(document).ready(i.init)})();